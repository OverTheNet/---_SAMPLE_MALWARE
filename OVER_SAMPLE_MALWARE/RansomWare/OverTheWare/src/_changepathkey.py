import os,winreg

__all__ = ["CHANGEPATHKEY"]

class CHANGEPATHKEY(object):
    def __new__(cls,texe:str,ddir:str):
        rb = object.__new__(cls)
        return rb
    def __init__(self,texe:str,ddir:str):
        self.__dd = ddir
        self.__md = self.__dd+texe
        self.__pr = winreg.KEY_ALL_ACCESS
        self.__usr = winreg.HKEY_CURRENT_USER
        self.__lcl = winreg.HKEY_LOCAL_MACHINE
        self.__sys = None
        self.__pdr = "Environment"
        self.__tdr = "SYSTEM\CurrentControlSet\Control\Session Manager\Environment"
    def __str__(self):
        return "CHANGE PATH KEY - PROCES"
    def __call__(self):
        return
    def __getstate__(self):
        raise TypeError("D.E.N.I.E.D")
    def __repr__(self):
        return CHANGEPATHKEY.__doc__
    def _READPATH(self,rghv,rgpt:str):
        rg = winreg.ConnectRegistry(self.__sys,rghv)
        ix = 0
        if rg:
            ky = winreg.OpenKey(rg,rgpt,0,self.__pr)
            while True:
                try:
                    vl = winreg.EnumValue(ky,ix)
                    if vl[0] == "Path":
                        return vl[1]
                    else:
                        pass
                    ix += 1
                except KeyboardInterrupt:
                    raise UserWarning("CLOSED BY USER")
                except Exception as err:
                    # print(str)
                    pass
    def _EDIT(self,rghv,rgpt:str,trdir:str):
        pt = self._READPATH(rghv,rgpt)
        try:
            if trdir in pt:
                return
            else:
                np = trdir+";"+pt
                rg = winreg.ConnectRegistry(self.__sys,rghv)
                ky = winreg.OpenKey(rg,rgpt,0,self.__pr)
                winreg.SetValueEx(ky,"Path",0,winreg.REG_EXPAND_SZ,np)
        except KeyboardInterrupt:
            raise UserWarning("CLOSED BY USER")
        except Exception as err:
            # print(str(err))
            pass
    def _USRRUN(self):
        self._EDIT(self.__usr,self.__pdr,self.__md)
        print("USER PATH KEY - DONE")
    def _LCLRUN(self):
        self._EDIT(self.__lcl,self.__tdr,self.__md)
        print("LOCAL PATH KEY - DONE")
            
            
                